---
import MainLayout from '../layouts/MainLayout.astro';
import Chat from '../components/Chat.tsx';
import { getLanguage } from '../i18n/index';
import { chatTranslations } from '../i18n/translations/chat';

const lang = getLanguage();
const tt = chatTranslations;
---

<MainLayout
  title={`${tt.pageTitle[lang]} | Restato`}
  description={tt.pageDescription[lang]}
>
  <div class="chat-container px-4 py-2">
    <Chat client:load />
  </div>

  <!-- Redirect to language-specific URL -->
  <script is:inline>
    (function() {
      const supportedLangs = ['ko', 'en', 'ja'];
      const currentPath = window.location.pathname;

      if (currentPath === '/anonymous-chat' || currentPath === '/anonymous-chat/') {
        let lang = localStorage.getItem('lang');
        if (!lang || !supportedLangs.includes(lang)) {
          const browserLang = navigator.language.split('-')[0];
          lang = supportedLangs.includes(browserLang) ? browserLang : 'ko';
        }
        window.location.replace('/' + lang + '/anonymous-chat');
      }
    })();
  </script>
</MainLayout>

<style>
  .chat-container {
    height: calc(100vh - 140px);
  }

  @media (max-width: 768px) {
    .chat-container {
      height: calc(100vh - 120px);
    }
  }
</style>
